apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: metrics-server-base
  annotations:
    config.kubernetes.io/local-config: "true"

resources:
  - https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml

namespace: kube-system

commonLabels:
  app.kubernetes.io/name: metrics-server
  app.kubernetes.io/part-of: homelab-infrastructure

patchesStrategicMerge:
  - security-context.yaml
  - resource-limits.yaml

patches:
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: metrics-server
    patch: |-
      - op: add
        path: /spec/template/spec/containers/0/args/-
        value: --kubelet-insecure-tls